!function(n){var e={};function o(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return n[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=n,o.c=e,o.d=function(t,i,n){o.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(i,t){if(1&t&&(i=o(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var e in i)o.d(n,e,function(t){return i[t]}.bind(null,e));return n},o.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(i,"a",i),i},o.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},o.p="",o(o.s=4)}([,,,function(t,i,n){"use strict";t.exports=function(o){function t(t,i){function n(){this.init&&this.init.apply(this,arguments)}var e=o.Util.create(t.prototype);return o.Util.extend(e,i),n.prototype=e,n}var i=t(rbush,{init:function(){rbush.apply(this,arguments),this._batch=[]},insert:function(t,i){return i?(this._batch.push(t),this):rbush.prototype.insert.call(this,t)},flush:function(){return this.load(this._batch),this._batch.length=0,this}}),n=t(i,{toBBox:function(t){var i=t._latlng;return{minX:i.lng,minY:i.lat,maxX:i.lng,maxY:i.lat}},compareMinX:function(t,i){return t._latlng.lng-i._latlng.lng},compareMinY:function(t,i){return t._latlng.lat-i._latlng.lat},searchIn:function(t){return this.search({minX:t.getWest(),minY:t.getSouth(),maxX:t.getEast(),maxY:t.getNorth()})},init:function(){i.prototype.init.apply(this,arguments),this._dirty=0,this._total=0},cleanup:function(){if(.1<=this._dirty/this._total){var t=this.all();this.clear(),this._dirty=0,this.load(t)}return this},insert:function(){return this._dirty++,this._total++,i.prototype.insert.apply(this,arguments)},remove:function(){return this._total--,i.prototype.remove.apply(this,arguments)},clear:function(){return this._dirty=0,this._total=0,rbush.prototype.clear.apply(this)}}),e=t(i,{toBBox:function(t){var i=t.options.icon.options.iconSize,n=t._point,e=i[0]/2,o=i[1]/2;return{minX:n.x-e,minY:n.y-o,maxX:n.x+e,maxY:n.y+o}},compareMinX:function(t,i){return t._point.x-i._point.x},compareMinY:function(t,i){return t._point.y-i._point.y},searchBy:function(t){return this.search({minX:t.x,minY:t.y,maxX:t.x,maxY:t.y})}}),r=o.Layer.extend({options:o.Canvas.prototype.options,initialize:function(t){o.Renderer.prototype.initialize.call(this,t),this._pointsIdx=new e,this._latlngsIdx=new n},onAdd:function(){o.Renderer.prototype.onAdd.call(this),o.DomUtil.toBack(this._container)},_initContainer:function(){o.Canvas.prototype._initContainer.call(this),this._hideContainer(!0)},onRemove:function(){o.Renderer.prototype.onRemove.call(this)},_destroyContainer:function(){o.Canvas.prototype._destroyContainer.call(this),this._pointsIdx.clear()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,click:this._onClick,mousemove:this._onMouseMove,mouseout:this._handleMouseOut};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){o.Renderer.prototype._onAnimZoom.call(this,t)},_onZoom:function(){o.Renderer.prototype._onZoom.call(this)},_updateTransform:function(t,i){o.Renderer.prototype._updateTransform.call(this,t,i)},_updatePaths:o.Util.falseFn,_update:function(){o.Canvas.prototype._update.call(this),this._draw()},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom)},_redraw:function(){o.Canvas.prototype._redraw.call(this)},_clear:function(){o.Canvas.prototype._clear.call(this)},_draw:function(){var t=this._redrawBounds;if(t){var i=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0,this._latlngsIdx.cleanup();var n=this._map.getBounds().pad(this.options.padding),e=!0;this._latlngsIdx.searchIn(n).forEach(function(t){t._map||(t._map=this._map),this._drawMarker(t),this._pointsIdx.insert(t,!0),e=!1},this),this._drawing=!1,this._pointsIdx.clear().flush(),this._hideContainer(e)},_drawMarker:function(t){t._point=this._map.latLngToLayerPoint(t.getLatLng()),this._imageLookup=this._imageLookup||{};var i=t.options.icon.options.iconUrl,n=this._imageLookup[i];if(t.canvas_img)n.loaded&&this._drawImage(t);else if(n)t.canvas_img=n.img,n.loaded?this._drawImage(t):n.queue.push(t);else{var e=new Image;e.src=i,t.canvas_img=e,n={loaded:!1,img:e,queue:[t]},this._imageLookup[i]=n,e.onload=function(){n.loaded=!0,n.queue.forEach(function(t){this.hasLayer(t)&&this._drawImage(t)},this)}.bind(this)}},_drawImage:function(t){var i=t.options.icon.options,n=t._point.subtract(i.iconAnchor);this._ctx.drawImage(t.canvas_img,n.x,n.y,i.iconSize[0],i.iconSize[1])},_onClick:function(t){var i,n=t.layerPoint||this._map.mouseEventToLayerPoint(t),e=this._pointsIdx&&this._pointsIdx.searchBy(n);e&&e.forEach(function(t){t.options.interactive&&!this._map._draggableMoved(t)&&(i=t)},this),i&&(o.DomEvent.fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var i=t.layerPoint||this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,i)}},_handleMouseHover:function(t,i){if(!this._mouseHoverThrottled){var n,e=this._pointsIdx&&this._pointsIdx.searchBy(i);e&&e.forEach(function(t){t.options.interactive&&(n=t)},this),n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(o.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(o.bind(function(){this._mouseHoverThrottled=!1},this),32)}},_handleMouseOut:function(t){o.Canvas.prototype._handleMouseOut.call(this,t)},_fireEvent:function(t,i,n){i.layerPoint?t[0].fire(n||i.type,i,!0):o.Canvas.prototype._fireEvent.call(this,t,i,n)},_addMarker:function(t,i,n,e){if(!(t instanceof o.Marker))throw new Error("Layer isn't a marker");t._map=this._map,o.Util.stamp(t),t.addEventParent(this),n&&(this._drawMarker(t),this._pointsIdx.insert(t,e),this._hideContainer(!1)),this._latlngsIdx.insert(t,e)},addMarker:function(t,i){i=i?i.toString():"0",this._groupIDs=this._groupIDs||{};var n=t.getLatLng(),e=this._map&&this._map.getBounds().pad(this.options.padding).contains(n);return this._addMarker(t,n,e),this._groupIDs[i]=(this._groupIDs[i]||0)+1,t._canvasGroupID=i,this},addLayer:function(t,i){return this.addMarker(t,i)},addMarkers:function(t,e){e=e?e.toString():"0",this._groupIDs=this._groupIDs||{},this._groupIDs[e]=this._groupIDs[e]||0;var o=this._map&&this._map.getBounds().pad(this.options.padding);return t.forEach(function(t){var i=t.getLatLng(),n=o&&o.contains(i);this._addMarker(t,i,n,!0),this._groupIDs[e]++,t._canvasGroupID=e},this),this._pointsIdx.flush(),this._latlngsIdx.flush(),this},addLayers:function(t,i){return this.addMarkers(t,i)},removeGroups:function(t){return t.forEach(function(t){this._removeGroup(t)},this),this._redraw(),this},removeGroup:function(t){return this._removeGroup(t),this._redraw(),this},_removeGroup:function(i){i=i.toString(),this._groupIDs[i]&&(delete this._groupIDs[i],this._latlngsIdx.all().filter(function(t){return t._canvasGroupID===i}).forEach(function(t){this.removeMarker(t,!1,!0)},this))},removeMarker:function(t,i,n){if(n||this.hasLayer(t))return this._latlngsIdx.remove(t),i&&this._map&&this._map.getBounds().pad(this.options.padding).contains(t.getLatLng())&&this._redraw(),t.removeEventParent(this),this},removeLayer:function(t){return this.removeMarker(t,!0)},clearLayers:function(){return this._latlngsIdx.clear(),this._pointsIdx.clear(),this._clear(),this},hasLayer:function(t){return t._eventParents[o.Util.stamp(this)]},_hideContainer:function(t){this._isEmpty!==t&&(this._isEmpty=t,this._container.style.display=t?"none":"initial")}});return o.canvasIconLayer=function(t){return new r(t)},r}},function(t,i,n){var e=n(3);window.L.CanvasIconLayer=e(L)}]);